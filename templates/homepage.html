{% extends "layout.html" %}

{% block content %}

<style>
    .custom-card {
        border-radius: 10px;
        overflow: hidden;
    }

    .custom-card-img {
        height: 220px;
        /* Set a fixed height for all images */
        object-fit: cover;
    }

    .custom-card-body {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 15px;
        /* A default background color */
        /* Default text color */
    }

    .custom-card-title,
    .custom-card-date {
        margin: 0;
    }

    .custom-btn-learn-more {
        background-color: #ffa500;
        border: none;
        border-radius: 5px;
        color: #ffffff;
        text-align: center;
        margin-top: 10px;
        /* Added margin to top */
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .custom-card-img {
            height: auto;
        }
    }
</style>

<div class="container mt-4">
    <h3 class="text-center">This Week's Most Popular Articles</h3>
    <div id="items-container" class="row">
        <!-- Article cards will be inserted here by JavaScript -->
    </div>
</div>

<script>

    document.addEventListener('DOMContentLoaded', function () {
        fetch('/api/featured_items')
            .then(response => response.json())
            .then(data => {
                const itemsContainer = document.querySelector('#items-container');

                data.forEach(item => {
                    const col = document.createElement('div');
                    col.className = 'col-md-4 mb-4 d-flex';

                    const card = document.createElement('div');
                    card.className = 'card custom-card flex-fill';

                    const img = document.createElement('img');
                    img.className = 'card-img-top custom-card-img';
                    img.alt = 'Article Image';

                    const cardBody = document.createElement('div');
                    cardBody.className = 'card-body custom-card-body d-flex flex-column';

                    const title = document.createElement('h5');
                    title.className = 'custom-card-title';
                    title.textContent = item.title;

                    const date = document.createElement('p');
                    date.className = 'custom-card-date';
                    date.textContent = item.published_date; // Use the actual property from the data

                    const button = document.createElement('a');
                    button.className = 'btn custom-btn-learn-more mt-auto'; // Align button to bottom
                    button.href = `/view/${item.id}`;
                    button.textContent = 'Learn More';

                    // Append the elements
                    cardBody.appendChild(title);
                    cardBody.appendChild(date);
                    cardBody.appendChild(button);
                    card.appendChild(img);
                    card.appendChild(cardBody);
                    col.appendChild(card);
                    itemsContainer.appendChild(col);

                    // Set image source and define onload function
                    img.onload = function () {
                        setPredominantBackgroundColor(img, cardBody, function (bgColor) {
                            const contrastColor = getContrastYIQ(bgColor);
                            // Directly apply the contrast color to text elements
                            title.style.color = contrastColor;
                            date.style.color = contrastColor;
                            button.style.color = contrastColor; // Optional: if you also want to change the button text color
                        });
                    };
                    img.src = item.image; // Set the image source
                });
            })
            .catch(error => {
                console.error('Error loading featured items:', error);
                itemsContainer.textContent = 'Failed to load featured items.';
            });
    });

</script>

{% endblock %}